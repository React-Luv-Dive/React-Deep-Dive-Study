# 모던 리액트 딥 다이브 5장 정리

### 상태 관리란?

상태는 애플리케이션의 시나리오에 따라 지속적으로 변경될 수 있는 값을 의미한다.
여기에는 UI 요소, URL, 폼 데이터, 서버에서 가져온 값 등이 포함된다.

상태 관리는 이러한 상태를 어디에 두고, 어떻게 관리하며, 자식 요소들이 상태를 구독하도록 만드는 과정을 포함합니다. 이는 애플리케이션의 복잡성을 관리하는 데 중요한 역할을 한다.

<br/>
### 상태 관리의 역사

- Flux
- Redux
- Context API, useContext
- React Query, SWR
- Recoil, Zustand, Jotai, Valito

<br/>

### 리액트 훅으로 시작하는 상태 관리

리액트 훅을 사용하여 상태 관리를 시작할 수 있다.

대표적인 훅으로는 useState와 useReducer가 있다. 이들은 주로 지역 상태 관리를 위해 사용된다.

<br/>

### 전역 상태 관리의 조건:

1. 상태는 컴포넌트 외부 어딘가에 존재하며 여러 컴포넌트에서 접근할 수 있어야 한다.
2. 상태를 구독할 수 있어야 하고, 참조하는 모든 컴포넌트에서 동일하게 동작해야 한다.
3. 상태가 객체인 경우, 구독하지 않는 값의 변화로 인해 불필요한 리렌더링이 발생해서는 안된다.

<br/>

### 상태 관리 라이브러리

지역 상태 관리의 한계를 극복하기 위해, 상태를 컴포넌트의 최상단이나 상태가 필요한 부모 컴포넌트, 혹은 격리된 자바스크립트 스코프에 둔다. 외부 상태 변경을 감지하여 각자의 방식으로 컴포넌트의 렌더링을 일으킨다.

- Recoil, Jotai:  
  Context, Provider, 훅을 기반으로 작은 상태를 효율적으로 관리하는 데 초점을 맞춥니다.

- Redux, Zustand:  
  하나의 큰 스토어를 기반으로 관리하며, Context가 아닌 스토어가 가지는 클로저를 기반으로 생성됩니다.

<br/>

### 자세한 설명

- **Recoil**  
  atom: 최소 상태 단위
  RecoilRoot로 생성된 Context의 스토어에 저장되며, 값이 변경되면 이를 참조하는 하위 컴포넌트에 알림을 보냅니다.

- **Jotai**  
  상향식(bottom-up) 접근 방식을 사용하며, 가장 작은 단위인 atom을 필요에 따라 조합하여 더 큰 단위의 상태로 확장합니다.
  Recoil과 동일하게 atom을 최소 단위로 하지만, 파생된 상태까지 만들 수 있습니다.

- 예제: 특정 시나리오에 유용한 파생된 상태

```js
export const locale_atom = atom<LocaleName>(\_locale || "en");
export const i18n_atom = atom((get) => new I18N(get(locale_atom)));
export const lang_atom = atom((get) => get(i18n_atom).lang);
```

- 예제: localStorage와 연동해 영구적으로 데이터 저장

```jsx
import { atomWithStorage } from 'jotai/utils';
import { useAtom } from 'jotai';
import { useEffect } from 'react';

const themeAtom = atomWithStorage('theme', 'light');

function ThemeSwitcher() {
  const [theme, setTheme] = useAtom(themeAtom);

  useEffect(() => {
    document.body.className = theme;
  }, [theme]);

  const toggleTheme = () => {
    setTheme(theme === 'light' ? 'dark' : 'light');
  };

  return (
    <button onClick={toggleTheme}>
      Switch to {theme === 'light' ? 'dark' : 'light'} theme
    </button>
  );
}
```

- **Zustand**  
  리덕스와 유사하게 하나의 스토어를 중앙 집중형으로 관리하며, 미들웨어를 지원합니다.

**Zustand와** Redux 비교:
Redux는 복잡한 상태 관리를 필요로 하고, 큰 규모의 프로젝트에 적합한 강력한 상태 관리 라이브러리입니다.
Zustand는 작은 규모의 프로젝트에 적합한 가벼운 상태 관리 라이브러리입니다.

Redux Toolkit(RTK)와 Zustand를 비교하는 것이 더 적합하며, 서버 상태 관리 라이브러리와의 조합 관점에서 선택할 수 있습니다.
