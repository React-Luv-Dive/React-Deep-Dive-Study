## 2.4 렌더링은 어떻게 일어나는가?

리액트의 렌더링은 시간과 리소스를 소비해 수행되는 과정이다.  
이 비용은 모두 웹 애플리케이션을 방문하는 사용자에게 청구된다. 시간이 길고 복잡해질수록 유저의 사용자 경험을 저해하기 때문에 렌더링 과정을 최소한으로 줄여야 한다.

### 2.4.1 리액트의 렌더링이란?

리액트 애플리케이션 트리 안에 있는 모든 컴포넌트들이 현재 자신들이 가지고 있는 props와 state의 값을 기반으로 **어떻게 UI를 구성하는지**. 그리고 이를 바탕으로 **어떤 DOM 결과를 브라우저에 제공할 것인지 계산**하는 일련의 과정이다.

### 2.4.2 리액트의 렌더링이 일어나는 이유

**리액트에서 렌더링이 발생하는 시나리오**  
아래 나열한 경우만이 리액트에서 렌더링이 일어나는 시나리오이다.  
useState로 관리되지 않는 단순한 변수는 아무리 변경된다 하더라도 리렌더링을 발생시키지 않아 변경된 값을 렌더링된 DOM에서 확인할 수 없다.

1. 최초 렌더링
2. 리렌더링

   - 클래스 컴포넌트의 setState가 실행되는 경우
   - 클래스 컴포넌트의 forceUpdate가 실행되는 경우

     렌더링을 수행하는 것은 인스턴스 메서드 render이다.  
     만약, 이 render가 state나 props가 아닌 다른 값에 의존하고 있어 리렌더링을 자동으로 실행할 수 없을 경우 forceUpdate를 실행해 리렌더링을 일으킬 수 있다.

     주의할 점은 render 내에서 forceUpdate()가 사용되면 무한 루프에 빠지므로 render 내부에서 사용하지 말아야 한다.

   - useState()의 두번째 배열 요소인 setter가 실행되는 경우

     state를 업데이트하는 함수이기에 렌더링이 일어난다.

   - useReducer()의 두번째 배열 요소인 dispatch가 실행되는 경우

     상태와 이 상태를 업데이트하는 함수를 배열로 제공한다. 그렇기에 렌더링이 일어난다.

   - 컴포넌트의 key props가 변경되는 경우

     > key는 명시적으로 선언돼 있지 않아도 모든 컴포넌트에서 사용할 수 있는 특수한 props이다.  
     > key는 배열에서 하위 컴포넌트를 선언할 때 사용된다.

     > **왜 key가 필요할까?**  
     > key는 리렌더링이 발생하는 동안 **형제 요소들 사이에서 동일한 요소를 식별하는 값**이다.  
     > 어떠한 컴포넌트가 변경이 있었는지 구별할 수 있도록 하는 값이 key이다.

     변경사항을 구별하는 것은 리렌더링이 필요한 컴포넌트를 최소화해야 하므로 반드시 필요한 작업이다.  
     key의 변화는 리렌더링을 야기한다. 이 특징을 이용하면 key를 활용해 강제로 리렌더링을 일으키는 것이 가능하다.

   - props가 변경되는 경우

   - 부모 컴포넌트가 렌더링 될 경우

     **부모 컴포넌트가 리렌더링된다면 자식 컴포넌트도 무조건 리렌더링이 일어난다.**

### 2.4.3 리액트의 렌더링 프로세스

업데이트가 필요하다고 지정돼 있는 컴포넌트를 발견하면 클래스 컴포넌트의 경우에는 클래스 내부의 render() 함수를 실행한다. 함수 컴포넌트의 경우에는 FunctionComponent() 그 자체를 호출한 뒤에 그 결과물을 저장한다.

렌더링 프로세스가 실행되면 여러 과정을 거쳐 각 컴포넌트의 렌더링 결과물을 수집한 다음, 리액트의 새로운 트리인 가상 DOM과 비교해 실제 DOM에 반영하기 위한 모든 변경 사항을 수집한다. 이것이 바로 재조정(Reconciliation)이다.

재조정 과정이 모두 끝나면 모든 변경 사항을 하나의 동기 시퀀스로 DOM에 적용해 변경된 결과물이 보이게 된다.

리액트의 렌더링은 렌더 단계와 커밋 단계, 총 두 단계로 분리되어 실행된다.

### 2.4.4 렌더와 커밋

- **렌더 단계 (Render Phase)**

  컴포넌트를 렌더링하고 변경 사항을 계산하는 모든 작업이다.  
  즉, 렌더링 프로세스에서 컴포넌트를 실행한 결과와 이전 가상 DOM을 비교하는 과정을 거쳐 변경이 필요한 컴포넌트를 체크하는 단계이다.

- **커밋 단계 (Commit Phase)**

  렌더 단계의 변경 사항을 실제 DOM에 적용해 사용자에게 보여주는 과정이다.  
  해당 단계가 끝나야 브라우저의 렌더링이 발생한다.

**리액트의 렌더링이 일어난다고 해서 무조건 DOM 업데이트가 일어나는 것은 아니다.**  
렌더링을 수행했으나 커밋 단계까지 갈 필요가 없다면, 즉 변경 사항을 계산했는데 아무런 변경 사항이 감지되지 않는다면 커밋 단계는 생략될 수 있다.

**리액트의 렌더링은 가시적인 변경이 일어나지 않아도 발생할 수 있다.**  
렌더 단계에서 변경 사항을 감지할 수 없다면 커밋 단계가 생략되어 브라우저의 DOM 업데이트가 일어나지 않을 수 있다.

두 과정으로 이뤄지 리액트의 렌더링은 항상 동기식으로 작동한다.  
따라서, 렌더링 과정이 길어질 수록 성능 저하와 작업 지연 가능성이 존재한다.
